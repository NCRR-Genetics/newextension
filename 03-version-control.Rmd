# Version control with Git {#version-control}

![](https://img.shields.io/badge/document%20status-in%20progress-orange?style=flat-square)

> When in RStudio, quickly jump to this page using `r3::open_version_control()`.

**Session objectives**:

1. Learn about "formal" version control and its importance.
1. Learn about Git for version control and apply RStudio's integrated Git tools.
1. Learn and apply the basic workflow of Git version control: 
View changes to files, record and save those changes to a history, 
and synchronize those changes to an online repository (GitHub).
1. Use GitHub to collaborate with others on a project.

## What is version control?

**Take 5 min and read through this section**, then we'll go through it together.

![Most common and simplest "version control". Image source from [PhD Comics](https://phdcomics.com/comics/archive_print.php?comicid=1531)](images/phd-comics-version-control.png)

While the above image is teasing a bit,
it is the most commonly used "version control" most people use.
How familiar are you with this way of saving your files and keeping track of versions?

This form of version control is fairly primitive, informal, and very manual.
However, there are other formal version control systems 
that automatically manage changes to a file or files. These
changes are kept as logs in a history, with detailed information on what file(s)
was changed, what was changed within the file, who changed it, and a message on
why the change was made.  This is extremely useful, especially when working in
teams or for yourself 6 months in the future (because you *will* forget things)!

To understand how incredibly powerful version control is, think about
these questions (or refer to the comic above!): How many files of different
versions of a manuscript or thesis do you have laying around after getting
feedback from your supervisor or co-authors? Have you ever wanted to experiment
with your code or your manuscript and need to make a new file so that the
original is not touched? Have you ever deleted something and wish you hadn't?
Have you ever forgotten what you were doing on a project?  All these problems
are fixed by using version control (git)! There are so many good reasons to use
version control:

- Claim to first discovery
- Defend against fraud
- Evidence of contributions and work
- Easily keep track of changes to files
- Easy collaboration
- Organized files and folders
- Less time findings things

In this session we are going to go over a typical workflow. This could be either
a solo workflow or a collaborative workflow. It will also mostly entirely be
done through RStudio.

## What is Git?

TODO: Add image.

From [xkcd](https://xkcd.com/1597/) here /img/xkcd-git.png

Git is a version control system and program. It contains many commands that you
can use to track and manage your files and changes to those files. It has many
features that make it ideal at tracking changes and for use in collaborative
settings. But because it was created by [Linux developers](https://en.wikipedia.org/wiki/Linus_Torvalds),
it isn't always easy to understand or use. If it's so hard to learn, why should
you learn Git? Well, because:

- It is very popular
- It has a very large online community that provide support, documentation, and
tutorials
- Most open source work is done with Git on [GitHub] (which is an online Git
hosting service)
- Many open scientific projects use Git
- RStudio has great integration with Git and a really nice interface

1. To know that learning version control is an investment and is *very worth it*
to learn as it pays off *very well* in the future

[GitHub]: https://github.com/

## Basics of Git

Let's do a quick check to see that everyone has Git properly set up. 
Run this function in your RStudio Console:

```{r, eval=FALSE}
r3::check_git_config()
```

You shouldn't get an error and it should show your email and name.

- Set up a Git repository in your project
- Tell Git to track a file by preparing it to be saved to the history
- Record a message on what you are preparing to save to the history and then save it
- 

Other things you'd do with Git:

- Check what's been changed or added in files since the last save
- Check the history for what was previously changed or add

When working with GitHub, there are extra things you'd do:

- Synchronize your Git repository on your computer with the repository on your GitHub,
called "push" (upload) and "pull" (download).

Set up a Git repository. (e.g. by checking box to start a Git repo when creating an R project,
automatically with prodigenr or with `usethis::use_git()`).

## Setting up a Git repository

First off, *what is the Git repository?* Remember how your project folder is set
up. There are actually several hidden files for Mac or Linux users or files
starting with `.` for Windows users. There are two important files/folders that
relate to Git, the `.gitignore` file and the `.git/` folder:

```
LearningR
├── .git/ <-- Here
├── R/
├── data/
├── doc/
├── .gitignore <-- Here
├── LearningR.Rproj
└── README.md
```

The `.gitignore` file tells Git to ignore tracking (or "watching") certain files
while the `.git/` folder contains all the changes and history for this folder...
This folder *is the repository*! Everything related to your project is found in 
that folder, so *don't delete it!*

To set up a repository we can either initialize immediately when we create a R
Project from the "New Projects" setup instructions. Or, if we already have a
R Project started we can use:

```{r, eval=FALSE}
usethis::use_git()
```

We now will be going through some steps in using Git in RStudio. We'll be doing
everything live through RStudio, so there is currently no coding involved right
now. See this excellent video on using [Git in RStudio]. We'll also be posting
the video of the session later on.

### Git stages overview

During the session we'll go over this image that goes over the different
"stages" in Git. There are basically four "stages" for files and changes:

1. Untracked files in the working folder.
2. Tracked (and possibled changed from previous version) files.
3. Files that have been changed and have been put into the "staging" area.
4. File changes stored in the history.

We won't be using the Git commands listed in the image. They are there for
reference.

```{r git-stages, eval=FALSE, echo=FALSE}
source(here::here("resources/diagrammer.R"))
# Need to generate manually
git_stages <- mermaid("
sequenceDiagram
    participant U as Untracked
    participant W as Working
    participant S as Staged
    participant H as History
    U->>S: git add
    W->>S: git add
    W->>H: git commit filename
    S->>H: git commit
    H->>W: git checkout
") 
html_print(git_stages, viewer = NULL) %>% 
    webshot(
        here::here("images/git-stages.png"),
        vwidth = 850,
        vheight = 550,
        cliprect = "viewport"
    )
```

<img src="/img/git-stages.png" alt="Stages of Git tracking" />
 
### Git "remotes" (GitHub) overview

When we cover GitHub, we'll need to go over some additional concepts and
commands. When dealing with GitHub, we have the concept of "remotes". A remote
is a location for the Git repository other than the one you are working on. So 
in this case, the GitHub location of your repository is called the remote. A
remote can be anywhere, including on other version control services like GitLab.

```{r git-remotes, eval=FALSE, echo=FALSE}
# Need to generate manually

mermaid("
graph TB
  A(GitHub) --> B('Local':<br>Your computer)
  B --> A
  A --> C('Local':<br>Collaborator's<br>computer)
  C --> A
")

git_remotes <- mermaid("
sequenceDiagram
    participant W as Working
    participant S as Staged
    participant H as History
    participant R as GitHub
    W->>S: git add
    W->>H: git commit filename
    S->>H: git commit
    H->>W: git checkout
    H->>R: git push
    R->>W: git pull
") 
html_print(git_remotes, viewer = NULL) %>% 
    webshot("static/img/git-remotes.png", vwidth = 850, vheight = 550, cliprect = "viewport")
```

<img src="/img/git-remotes.png" alt="Remotes and the links between repositories." />

```{r, eval=FALSE}
source(here::here("resources/diagrammer.R"))
grViz("
      ")
```

