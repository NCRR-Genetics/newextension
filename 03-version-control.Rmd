# Version control with Git {#version-control}

![](https://img.shields.io/badge/document%20status-in%20progress-orange?style=flat-square)

> When in RStudio, quickly jump to this page using `r3::open_version_control()`.

**Session objectives**:

1. Learn about "formal" version control and its importance.
1. Learn about Git for version control and apply RStudio's integrated Git tools.
1. Learn and apply the basic workflow of Git version control: 
View changes to files, record and save those changes to a history, 
and synchronize those changes to an online repository (GitHub).
1. Use GitHub to collaborate with others on a project.

## What is version control?

**Take 5 min and read through this section**.

!["Final" version of a document, using a common and simple "version control system". Image source: [PhD Comics](https://phdcomics.com/comics/archive_print.php?comicid=1531)](images/phd-comics-version-control.png)

![Filenaming used for the common "version control". Image source: [PhD Comics](https://phdcomics.com/comics.php?f=1323)](images/informal-version-control.gif)

Does this way of saving files and keeping track of versions look familiar?
While the above images are teasing a bit,
there is truth to is: it is the most commonly used "version control".

This form of version control, while common,
is fairly primitive, informal, and very manual.
It isn't ideal because it requires making multiple copies of the same file, 
even if changes made are done to only one small part of the file. 
This approach also makes it difficult to find specific changes done.

There are, however, formal version control systems 
that automatically manage changes to a file or files. 

These formal version control systems take snapshots of changes done to files,
which usually called "revisions" or "commits". 
These "commits" record what was changed since the previous "commit".
When you make these "commits",
you have to create a short message on what or why you made change.
These "commits" are stored as a log entry in a history.
This history then has all this information,
for each commit,
on what file or files were changed, 
what was changed within the file(s), 
who changed it, and the short message about the change.
This is extremely useful, 
especially when working in teams 
or for yourself 6 months in the future 
(because you *will* forget things),
since you can go back and quickly see what happened and why.

To understand how incredibly powerful version control is, 
think about these questions (or refer to the comic above!): 

- How many files of different versions of a manuscript 
or thesis do you have laying around after getting feedback from your supervisor 
or co-authors? 
- Have you ever wanted to experiment with your code 
or your manuscript 
and need to make a new file so that the original is not modified? 
- Have you ever deleted something and wish you hadn't?
- Have you ever forgotten what you were doing on a project?  

All these problems can fixed by using formal version control! 
There are so many good reasons to use version control, especially in science:

- Transparency of work done (to demonstrate or substantiate your scientific claim)
- Claim to first discovery (you have a timestamped history of your work)
- Defend against fraud (because of the transparency)
- Evidence of contributions and work (who does what is tracked)
- Easily keep track of changes to files (by looking at the history of changes)
- Easy collaboration (because you can work on a single file/folder rather than emailing versions around)
- Organized files and folders (one single project folder and one single file, rather than multiple)
- Less time findings things (because everything is organized)

In this session we'll be covering a version control tool called [Git].
While Git on its own can be quite difficult to use, 
RStudio thankfully has an amazing and straight-forward integration to it.

[Git]: https://git-scm.com/book/en/v2/Getting-Started-What-is-Git%3F

## What is Git?

Git is one of several version control system tools available.
It was developed to help the software programmers 
to develop and manage their work on [Linux]
(an operating system like Mac or Windows).
Sadly, it was designed by and for software programmers 
and not for non-programmer users (like us!).
So why do we teach it? 
Because there are so many great features of Git that fit with how science 
and data analysis is done!

- Like R, it is open source, so it's free and anyone can check that the code is correct
- It is very popular
and so has a very large online community that provides support, 
documentation, and tutorials on how to use it
- The vast majority of open source work, like developing R packages,
is done using Git and is hosted on [GitHub],
which is a company that hosts Git "repositories" (i.e. projects) online
    - All RStudio code and tidyverse packages are on GitHub
- There are many open scientific projects that use Git and are hosted on GitHub,
e.g. [rOpenSci](https://github.com/ropensci) organization,
[MRC Integrated Epidemiology Unit](https://github.com/MRCIEU)
- RStudio has an amazing interface and integration with Git

[GitHub]: https://github.com/

While learning Git and version control can be difficult 
and have a steep learning curve,
like learning R,
it is ultimately an investment into your future productivity 
and effectiveness as a researcher.
It is *very much worth it* to learn and use it as often as you can.

## Basics of Git

How Git works is by tracking changes to files *at the project level* 
(i.e. for every R Project).
So you won't track your entire, for instance, `My Documents/` folder.
When file changes are saved and put into the history,
this history is called a "repository" (also called a "repo" for short). 
We'll explain what a repository is more later.

For every project we need to setup 
and associate a Git repository with the project folder.
Before you continue, 
go into your `LearningR` R Project
and do a quick check to make sure that everyone has Git properly set up. 
Run this function in your RStudio Console:

```{r, eval=FALSE}
r3::check_git_config()
```

You shouldn't get an error and it should show your email and name.

- Set up a Git repository in your project
- Tell Git to track a file by preparing it to be saved to the history
- Record a message on what you are preparing to save to the history and then save it
- 

Other things you'd do with Git:

- Check what's been changed or added in files since the last save
- Check the history for what was previously changed or add

When working with GitHub, there are extra things you'd do:

- Synchronize your Git repository on your computer with the repository on your GitHub,
called "push" (upload) and "pull" (download).

Set up a Git repository. (e.g. by checking box to start a Git repo when creating an R project,
automatically with prodigenr or with `usethis::use_git()`).

## Setting up a Git repository

First off, *what is the Git repository?* Remember how your project folder is set
up. There are actually several hidden files for Mac or Linux users or files
starting with `.` for Windows users. There are two important files/folders that
relate to Git, the `.gitignore` file and the `.git/` folder:

```
LearningR
├── .git/ <-- Here
├── R/
├── data/
├── doc/
├── .gitignore <-- Here
├── LearningR.Rproj
└── README.md
```

The `.gitignore` file tells Git to ignore tracking (or "watching") certain files
while the `.git/` folder contains all the changes and history for this folder...
This folder *is the repository*! Everything related to your project is found in 
that folder, so *don't delete it!*

To set up a repository we can either initialize immediately when we create a R
Project from the "New Projects" setup instructions. Or, if we already have a
R Project started we can use:

```{r, eval=FALSE}
usethis::use_git()
```

We now will be going through some steps in using Git in RStudio. We'll be doing
everything live through RStudio, so there is currently no coding involved right
now. See this excellent video on using [Git in RStudio]. We'll also be posting
the video of the session later on.

### Git stages overview

During the session we'll go over this image that goes over the different
"stages" in Git. There are basically four "stages" for files and changes:

1. Untracked files in the working folder.
2. Tracked (and possibled changed from previous version) files.
3. Files that have been changed and have been put into the "staging" area.
4. File changes stored in the history.

We won't be using the Git commands listed in the image. They are there for
reference.

<img src="/img/git-stages.png" alt="Stages of Git tracking" />
 
### Git "remotes" (GitHub) overview

When we cover GitHub, we'll need to go over some additional concepts and
commands. When dealing with GitHub, we have the concept of "remotes". A remote
is a location for the Git repository other than the one you are working on. So 
in this case, the GitHub location of your repository is called the remote. A
remote can be anywhere, including on other version control services like GitLab.

Steps:

1. RStudio create from GitHub
2. Copy and paste folder contents into this newly created project
3. Add, commit.
4. Push to GitHub and confirm it pushed.

For both "owners" and "collaborators"

## Final exercise: Group work

Time: 30 min

For this exercise, you as a group will upload your group project folder to GitHub.
We've already created a team repository for you 
(which you should already have access to).
From this point on you'll use Git and GitHub to collaborate on your project.

- During the R project session's final exercise on the first day, 
you designated a "coordinator" in your group. 
For this task, 
the coordinator needs to link their project to the team's GitHub repository 
and upload (push) their project files to GitHub.
- After the coordinator has done this, 
each team member must "clone" (download) 
the updated project using RStudio's interface
("File -> New Project -> Version Control -> Git").
Then they need to take any files they worked on in their old project folder
and move them into the newly created Git repository.
Then add, commit, and push those file changes to GitHub.
    - You'll likely have to deal with Merge Conflicts at this point. 
    We'll be here to help out.
- Then complete item 5 and its subtasks in the [group assignment](assignment.html)
(to jump quickly to the assignment, 
